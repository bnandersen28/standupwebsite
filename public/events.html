<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
  <title>Events</title>
</head>
<body>
  <header>
    <div class="header-top">
  <img src="imgs/ink.png" alt=" Stick Figures" class = "stick-logo">
  
  </div>
<nav class = "navbar">
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="about.html">About Us</a></li>
    <li><a href="team.html">Our team</a></li>
    <li><a href="projects.html">Projects</a></li>
    <li><a href="events.html">Calendar</a></li>
    <li><a href="involve.html">Your Input</a></li>
  </ul>
</nav>
</header>
<body>
<div class ="events-buttons">
  <h1 >Events</h1>

  <button id="upcoming" class="rainbow-button">Upcoming Events</button>
  <button id="past" class="rainbow-button">Past Events</button>
  <div id="events-container"></div>
</div>

  </body> 
  <footer class="footer">
    <div class="footer-section">
        <h1>Contact Us</h1>
        <p><a href="mailto:standup4everyone@gmail.com">standup4everyone@gmail.com</a></p>
    </div>
    <div class="footer-divider"></div>
    <div class="footer-section">
        <h1>Follow us</h1>
        <a href=" https://www.instagram.com/standupforyourselfandothers/" target="_blank">Instagram: @standupforyourselfandothers</p>
    </div>
  </footer>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { firebaseConfig } from "./firebaseConfig.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", async ()=>{
      const eventsContainer = document.getElementById('events-container');
      const upcomingButton = document.getElementById('upcoming');
      const pastButton = document.getElementById('past');

      let allEvents = [];

      //Load events from Firestore
      async function loadEvents(){
        allEvents = [];
        const q = query(collection(db, "events"), orderBy("date", "asc"));
        const querySnapshot = await getDocs(q);
        querySnapshot.forEach((doc) => {
          const eventData = doc.data();

          const dateValue = eventData.date?.toDate ? eventData.date.toDate() : new Date(eventData.date);
          allEvents.push({
            id: doc.id,
            title: eventData.title,
            date: dateValue.toISOString().split('T')[0],
            time: eventData.time,
            location: eventData.location,
            description: eventData.description
          });
        });
      }

      function displayEvents(events){
        eventsContainer.innerHTML = '';

        if (events.length === 0) {
          eventsContainer.innerHTML = '<p>No events to display.</p>';
          return;
        }
        
        events.forEach(event => {
          const eventDiv = document.createElement('div');
          eventDiv.classList.add('event');

          //Create title element
          const title = document.createElement('h2');
          title.textContent = event.title;
          title.classList.add('event-title');
          title.style.cursor = 'pointer';

          //Create details container
          const details = document.createElement('div');
          details.classList.add('event-details');
          details.style.display = 'none';
          details.innerHTML = `
            <p><strong>Date:</strong> ${event.date}</p>
            <p><strong>Time:</strong> ${event.time}</p>
            <p><strong>Location:</strong> ${event.location}</p>
            <p><strong> ${event.description}</p>
          `;

          title.addEventListener('click', () => {
            details.style.display = details.style.display === 'none' ? 'block' : 'none';
          });
          eventDiv.appendChild(title);
          eventDiv.appendChild(details);
          eventsContainer.appendChild(eventDiv);
        });
      }
      upcomingButton.addEventListener('click', () => {
        const now = new Date();
        const upcomingEvents = allEvents.filter(event => new Date(event.date) >= now);
        displayEvents(upcomingEvents);
      });
      pastButton.addEventListener('click', () => {
        const now = new Date();
        const pastEvents = allEvents.filter(event => new Date(event.date) < now);
        displayEvents(pastEvents);
      });
      await loadEvents();
    })
  </script>
  </html>